{{ range $path, $_ :=  $.Files.Glob  (printf "namespace-spec/**.yaml" .Values.cluster ) }}
{{ $ns := ($.Files.Get $path ) | fromYaml }}
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: deployment
  namespace: {{ $ns.name }}
rules:
#  TODO: Tune these rules
- apiGroups:
  - "*"
  resources:
  - "*"
  verbs:
  - "*"
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: ns-admin
  namespace: {{ $ns.name }}
rules:
#  TODO: Tune these rules further
- apiGroups:
  - "*"
  resources:
  - deployments
  - deployments/scale
  - pods
  - pods/exec
  - replicasets
  - services
  - secrets # TODO: add a conditional based on cluster type read vs write if required later on
  - configmaps
  - ingresses
  - jobs
  - cronjobs
  - horizontalpodautoscalers
  verbs:
  - get
  - watch
  - list
  - create
  - delete
  - patch
  - update
- apiGroups:
  - "*"
  resources:
  - serviceaccounts
  - limitranges
  - resourcequotas
  - roles
  - rolebindings
  - pods/log
  - deployments/status
  - events
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: ns-reader
  namespace: {{ $ns.name }}
rules:
#  TODO: Tune these rules further
- apiGroups:
  - "*"
  resources:
  - deployments
  - deployments/status
  - pods
  - replicasets
  - services
  - configmaps
  - ingresses
  - horizontalpodautoscalers
  - limitranges
  - resourcequotas
  - pods/log
  - events
  verbs:
  - get
  - watch
  - list
{{- end }}